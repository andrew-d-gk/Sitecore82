/*! SPEAK.js, 1.0.2 - generated on 2016-09-19 */
(function(){for(var e,t=function(){},i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=i.length,r=window.console=window.console||{};n--;)e=i[n],r[e]||(r[e]=t)})(),function(){"use strict";var e,t,i,n,r,a,o,s=this,l={},u=s.__SITECOREDEBUG||!1,d={},c=window._sc;s.Sitecore!==void 0?l=s.Sitecore.Speak:(s.Sitecore={},s.Sitecore.Speak={}),t=e="undefined"!=typeof exports?exports:s.Sitecore.Speak=s._sc={};var p=s.jQuery,h=s._,f=s.ko;h||"undefined"==typeof require||(h=require("underscore")),Backbone||"undefined"==typeof require||(h=require("backbone")),f||"undefined"==typeof require||(f=require("knockout")),t.VERSION="1.0.1",t.__SPEAKDEBUG=u,t.__info=d,t.Pipelines={},t.Factories={},t.Commands={},t.Behaviors={},t.Definitions={Models:{},Views:{},Data:{}},i=t.Definitions.Models,n=t.Definitions.Views,r=t.Definitions.Data,a=t.Commands,o=t.Factories,t.Web={},t.SiteInfo={},t.SiteInfo.virtualFolder="/",t.debug=function(){if(u){switch(arguments.length){case 1:return console.log(arguments[0]),void 0;case 2:return console.log(arguments[0],arguments[1]),void 0;case 3:console.log(arguments[0],arguments[1],arguments[2]);case 4:return console.log(arguments[0],arguments[1],arguments[2],arguments[3]),void 0}console.log(arguments)}};var m=function(e,t,i){var n=new f.bindingProvider,r=n.nodeHasBindings;return n.exclusionSelector=e,n.nodeHasBindings=function(e){return 8===e.nodeType||p(e).is(n.exclusionSelector)||0!==p(e).closest(t).length?8!==e.nodeType||e.registered?!1:r.call(this,e):r.call(this,e)},n.getBindings=function(e,t){var n=t.$root.$el,r=p(e).closest(i);if(n&&r.length){var a=n.is(r);if(!a)return null}return f.bindingProvider.prototype.getBindings.apply(this,arguments)},n};f.bindingProvider.instance=new m(".data-sc-registered",".data-sc-waiting","[data-sc-id]"),f.bindingHandlers.readonly={update:function(e,t){var i=f.utils.unwrapObservable(t());i?e.setAttribute("readOnly",!0):e.removeAttribute("readOnly")}},s.dialogClose=function(e){t.trigger("sc-frame-message",e)},s.receiveMessage=function(e,i){t.trigger("sc-frame-message",e,i)},s.getParameterByName=function(e){return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regexS="[\\?&]"+e+"=([^&#]*)",regex=RegExp(regexS),results=regex.exec(window.location.href),null==results?"":decodeURIComponent(results[1].replace(/\+/g," "))},function(e){e.Model.extend=e.Collection.extend=e.Router.extend=e.View.extend=function(e,t){var n=i(this,e,t);return n.extend=this.extend,n};var t=function(){},i=function(i,n,r){var a,o=i.prototype,s=/xyz/.test(function(){})?/\b_super\b/:/.*/;if(a=n&&n.hasOwnProperty("constructor")?n.constructor:function(){i.apply(this,arguments)},h.extend(a,i),t.prototype=i.prototype,a.prototype=new t,n){h.extend(a.prototype,n);var l=n.nestedlayout||a.prototype.nestedlayout,u=a.prototype.modelType===e.Model;u||n.render||l||(n.render=function(){}),u||n.afterRender||l||(n.afterRender=function(){}),u||n.beforeRender||l||(n.beforeRender=function(){});for(var d in n)"function"==typeof n[d]&&"function"==typeof o[d]&&s.test(n[d])&&(a.prototype[d]=function(e,t){return function(){var i=this._super;this._super=o[e];var n=t.apply(this,arguments);return this._super=i,n}}(d,n[d])),l||u||"render"!==d&&"beforeRender"!==d&&"afterRender"!==d||(a.prototype[d]=function(e,t){return function(){if(t.apply(this,arguments),this.hasBehavior){var i=[];"render"===e&&(i=this.behaviorsRender),"afterRender"===e&&(i=this.behaviorsAfterRender),"beforeRender"===e&&(i=this.behaviorsBeforeRender),h.each(i,function(e){e.apply(this,arguments)},this)}}}(d,n[d]))}return r&&h.extend(a,r),a.prototype.constructor=a,a.__super__=i.prototype,a}}(Backbone),i.Model=Backbone.Model.extend({ko:!0,modelType:Backbone.Model,set:function(){var e=arguments[2];arguments[2]||(arguments[2]={}),h.clone(arguments[2].silent);var t=arguments[2].force;if(Backbone.Model.prototype.set.apply(this,arguments),e&&e.computed&&(this.computed=this.computed||{},this.computed[arguments[0]]=e),h.isObject(arguments[0])||e&&e.local||this.updateViewModel(arguments[0],t),h.isObject(arguments[0])&&(!e||!e.local)){var i=arguments[0],n=h.keys(i);h.each(n,function(e){this.updateViewModel(e)},this)}},constructor:function(t){this.ko&&(this.viewModel={}),this.defaults&&t&&h.isObject(t)&&(this.defaults=h.extend(this.defaults,t)),this.ko&&this.defaults&&(this._removeComputed(),this._creatingViewModelFromDefaults()),this.useLocalStorage&&(this.localStorage=new e.Definitions.Data.LocalStorage(t.name)),Backbone.Model.apply(this,[t]),this.ko&&(this._setComputed(),this._preventDefaultFunction(),this._creatingViewModel())},_preventDefaultFunction:function(){var e=["_creatingViewModel","_creatingViewModelFromDefaults","_setComputed","_findAppropriateAndApplyBinding","_removeComputed","_super","_preventDefaultFunction","_validate","bind","change","changedAttributes","clear","clone","constructor","destroy","escape","fetch","get","has","hasChanged","initialize","isNew","isValid","observable","off","on","parse","previous","previousAttributes","save","set","toJSON","trigger","unbind","unset","url"],t=h.functions(this);this.applicableFunctionsFromModel=h.reject(t,function(t){return h.indexOf(e,t)>=0})},_creatingViewModelFromDefaults:function(){var e=this,t=h.keys(this.defaults);h.each(t,function(e){this._findAppropriateAndApplyBinding(e,this.defaults)},this);var i={};this.applicableFunctionsFromModel&&h.each(this.applicableFunctionsFromModel,function(t){i[t]=function(){e[t].apply(e,arguments)}}),h.extend(this.viewModel,i)},_removeComputed:function(){var e=h.keys(this.defaults),t=this.defaults,i=this,n=[];h.each(e,function(e){var i=t[e];if(h.isObject(i)&&i.computed){var r=h.clone(i),a={computed:!0,read:r.read};r.write&&(a=h.extend(a,{write:r.write})),r.owner&&(a=h.extend(a,{owner:r.owner})),n.push({key:e,value:r.value,computed:a}),delete t[e]}}),i.computeds=n},_setComputed:function(){h.each(this.computeds,function(e){var t=e.value||"",i=h.extend(e.computed,{local:!0});this.set(e.key,t,e.computed,i)},this)},updateViewModel:function(e,t){(this.viewModel&&!this.viewModel[e]||t)&&this._findAppropriateAndApplyBinding(e,this.attributes,t)},_findAppropriateAndApplyBinding:function(e,t,i){var n=this.viewModel||{};if(!n[e]||i){if(h.isArray(t[e]))if(t[e].length>0&&t[e][0]&&t[e][0].modelType===Backbone.Model){var r=[];h.each(t[e],function(e){r.push(e.viewModel)}),n[e]=f.observableArray(r),n[e].nested=!0}else n[e]=f.observableArray(t[e]);else t[e]&&t[e].constructor&&h.isObject(t[e].constructor.__super__)&&t[e].ko?(n[e]=t[e].viewModel,n[e].nested=!0):this.computed&&this.computed[e]||(n[e]=f.observable(t[e]));this._registerComputed(e),this._registerSubscribe(e)}},_registerSubscribe:function(e){var t=this,i=this.subscriptions||[],n=this.viewModel||{};n[e].nested||(n[e].isComputed||t.on("change:"+e,function(){if(h.isArray(t.get(e))&&t.get(e).length>0&&t.get(e)[0]&&t.get(e)[0].modelType&&t.get(e)[0].modelType===Backbone.Model){var i=[];h.each(t.get(e),function(e){i.push(e.viewModel)}),n[e](i)}else n[e](t.get(e))}),n[e].subscribe&&(i[e]=n[e].subscribe(function(i){t.set(e,i)})))},_registerComputed:function(e){var t=this,i=this.viewModel||{};if(t.computed&&t.computed[e]){this.computed[e].write&&!this.computed[e].owner&&(t.computed[e].owner=this.viewModel);var n=h.pick(t.computed[e],"write","owner","read");i[e]=n.write?f.computed(n):f.computed(n.read,this.viewModel),i[e].isComputed=!0}},_creatingViewModel:function(){var e=h.keys(this.attributes);h.each(e,function(e){this._findAppropriateAndApplyBinding(e,this.attributes)},this),h.each(e,this._registerComputed,this),h.each(e,this._registerSubscribe,this)}}),i.Model.extend=Backbone.Model.extend,n.View=function(t){t&&(this.app=t.app?t.app:"No parent for this app",delete t.app);var i=this;t&&t.behaviors&&h.each(t.behaviors.split(" "),function(t){i.addBehavior(e.Behaviors[t])}),Backbone.View.apply(this,[t]),this.model&&this.$el&&!this.model.viewModel.$el&&(this.model.viewModel.$el=this.$el),this.model&&this.app&&!this.model.viewModel.app&&(this.model.viewModel.app=this.app),this.setupFunctionWhichCouldBeDataBound(),this.sync()},h.extend(e.Definitions.Views.View.prototype,Backbone.View.prototype,{setupFunctionWhichCouldBeDataBound:function(){var e=["$","_configure","_ensureElement","setupFunctionWhichCouldBeDataBound","applyBindingsIfApplicable","bind","constructor","delegateEvents","initialize","make","off","on","remove","render","setElement","trigger","unbind","undelegateEvents","afterRender","beforeRender","sync"],t=h.functions(this);this.applicableFunctionsFromView=h.reject(t,function(t){return h.indexOf(e,t)>=0});var i=this;h.each(this.applicableFunctionsFromView,function(e){if(this.model&&this.model.viewModel[e])throw"Conflicted names between Model and View, please provide different names: "+e;this.model&&(this.model.viewModel[e]=function(){return i[e].apply(i,arguments)})},this)},sync:function(){this.model&&this.model.ko&&(u&&console.log("Applying Binding for the element which has the data-sc-id: "+this.$el.data("sc-id")+". The viewModel you are trying to apply is:",this.model.viewModel),f.applyBindings(this.model.viewModel?this.model.viewModel:this.model,this.$el.get(0)))},listen:{}}),n.View.extend=Backbone.View.extend,e.Definitions.App=Backbone.Model.extend({appId:void 0,modelType:"application",initialize:function(){this.Controls=[],this.localStorage=this.appId?new e.Definitions.Data.LocalStorage(this.appId):"you need to provide a appID in order to use localStorage"},run:function(e,i,n){var r=t.Factories.createApp(e,i,n,this);return this.initialized!==void 0&&this.initialized(),r.ScopedEl.find("[data-sc-cloak]").removeAttr("data-sc-cloak"),r.trigger("app:loaded"),r},insertControl:function(e,t,i){var n=this;p.post("/api/rendering",e,function(e){n.insertMarkups(e,name,t,i)})},insertRendering:function(e,i,n){var r,a,o,s,l,u=this,d=i.ajax||{},c={database:"core",path:"/sitecore/shell/api/sitecore/Layout/RenderItem"},f=n,m=p("meta[data-sc-name=sitecoreLanguage]").attr("data-sc-content");d&&d.success&&(s=d.success),l=d.error,h.isFunction(i)?f=i:i&&(c=h.extend(c,i),r=i.selector?i.selector:void 0,a=i.$el?i.$el:void 0),c.name||(c.name=h.uniqueId("subapp_"));var v=c.path+"?sc_itemid="+e+"&sc_database="+c.database+(m?"&sc_lang="+m:"");return o=p.ajax({url:v,method:"GET",beforeSend:d.beforeSend,success:function(e,t,i){s&&s.call(e,t,i),u.insertMarkups(e,c.name,{selector:r,$el:a},f)},error:function(e,i,n){return 401===e.status?(t.Helpers.session.unauthorized(),void 0):(l&&l.call(e,i,n),void 0)},complete:d.complete})},insertMarkups:function(e,i,n,r){var a,o={prepend:!1,selector:void 0,parent:void 0,$el:void 0},n=h.extend(o,n),s="<div id='"+i+"' data-sc-app style='display:none;'>"+e+"</div>";a=n.$el?n.$el:n.selector?p(n.selector):p("body"),n.prepend?a.prepend(s):a.append(s),t.load(window,a.find("#"+i),function(e){e.ScopedEl.show(),r&&r(e)})},destroy:function(){var t=this;h.each(t.Controls,function(e){e.view.$el.data("sc-app",null),e.view.$el.removeClass("data-sc-registered")});for(var i in t)t[i]instanceof e.Definitions.App&&h.each(t[i].Controls,function(e){e.view.$el.data("sc-app",null),e.view.$el.removeClass("data-sc-registered")});h.each(t.Controls,function(e){f.cleanNode(e.view.$el.get(0)),delete e.model,delete e.view});for(var i in t)delete t[i];return void 0},closeDialog:function(e){window.top.returnValue=e,window.top.dialogClose(e)},sendMessage:function(e){window.top.receiveMessage(e,s.getParameterByName("sp"))}}),e.Definitions.App.extend=Backbone.View.extend,h.extend(e,Backbone.Events),h.extend(n.View.prototype,{addBehavior:function(e){if(this.hasBehavior=!0,this.behaviors=this.behaviors||[],this.behaviorsBeforeRender=this.behaviorsBeforeRender||[],this.behaviorsAfterRender=this.behaviorsAfterRender||[],this.behaviorsRender=this.behaviorsRender||[],!(e.initialize||e.afterRender||e.render||e.beforeRender))throw"behavior should have an initialize or an after Render method";e.events&&(this.events?h.extend(this.events,e.events):this.events=e.events),e.initialize&&this.behaviors.push(e.initialize),e.afterRender&&this.behaviorsAfterRender.push(e.afterRender),e.render&&this.behaviorsRender.push(e.render),e.beforeRender&&this.behaviorsBeforeRender.push(e.beforeRender);var t=h.omit(e,"initialize","events","afterRender","render","beforeRender");h.extend(this,t)}}),h.extend(t,{destroy:function(t){if(!t&&!t.destroy)throw"you need an app to be destroy";var i=t.name;t.destroy(),delete e[i]},noConflict:function(t){return s._sc===e&&(s._sc=c),t&&s.Speak===e&&(s.Speak=l),e}}),h.extend(t,{load:function(i,n,r){var a=[],o=[],s=!1;if(n||(n=p("html"),s=!0),p(n).find("[data-sc-require]").each(function(){var e=p(this);e.is("[data-sc-app]")||"text/x-sitecore-pagecode"===e.attr("type")||p.each(e.data("sc-require").split(","),function(e,t){0>h.indexOf(o,t)&&o.push(t)})}),window.__speak_config&&window.__speak_config.useBundle){var l=window.location.origin+"/-/speak/v1/bundles/bundle.js?c=1&n=1&f="+o.join(",");a.push(l)}else a=a.concat(o);var u=[],d=i.__sc_define;i.__sc_define=function(e,t,i){"string"==typeof e&&u.push(e),d&&d(e,t,i)},p(n).find("script[type='text/x-sitecore-pagecode']").each(function(){i.__sc_define(p(this).attr("data-sc-require"))}),require(a,function(){var a=p(n).find("script[type='text/x-sitecore-pagecode']"),l=p(n),c=a.attr("data-sc-require"),h=a.data("sc-behaviors"),f=null;l.attr("data-sc-behaviors",h);var m=function(){if(0==u.length){i.__sc_define=d;var e=new f;r?r(e.run(n.attr("id"),n.attr("id"))):e.run(),s&&t.Helpers.overlay.loadOverlays(e)}else{var a=u;u=[],t.debug("Requiring files: ",a),require(a,m)}},v=function(){if(0===u.length)if(c)t.debug("Requiring page code: ",[c]),require([c],function(e){f=e,m()});else{i.__sc_define=d;var a;s?(a=e.Factories.createApp(),t.Helpers.overlay.loadOverlays(a),a.initialized!==void 0&&a.initialized()):a=e.Factories.createApp(n.attr("id"),n.attr("id")),a.ScopedEl.find("[data-sc-cloak]").removeAttr("data-sc-cloak"),s&&a.trigger("app:loaded"),r&&r(a)}else{var o=u;u=[],t.debug("Requiring files: ",o),require(o,v)}};window.__speak_config&&window.__speak_config.useBundle?require(o,function(){v()}):v()})}}),h.extend(a,{resolve:function(e){if(!h.isString(e))throw"provied a correct Path to resolve";for(var t=e.split("."),i=s||window,n=0;t.length>n;n++)if(i=i[t[n]],null==i)throw"Reference '"+e+"' not found";return i},executeCommand:function(e,t){if(!e||!h.isString(e))throw"cannot execute command without commandName";var i=a.getCommand(e);i.canExecute(t)&&i.execute(t)},getCommand:function(e){return a.resolve(e)}});var v=function(){var e=this._scAttrs;h.each(e,function(e){if(e.value&&-1!==e.value.indexOf("$el.")){var t=e.value.substring("$el.".length);if(-1!==t.indexOf(":")){var i=t.split(":");if(2===i.length){var n=this.$el[i[0]](i[1]);n!==void 0?this.model.set(e.name,n):e.defaultValue&&this.model.set(e.name,e.defaultValue)}}else this.model.set(e.name,this.$el[t]())}},this),h.each(e,function(e){e.on&&this.model.on("change:"+e.name,this[e.on],this)},this)},g=function(){this._scAttrs&&h.each(this._scAttrs,function(e){var t=h.keys(e),i=this.localStorage.get(e.name);i?this.set(e.name,i):-1===t.indexOf("defaultValue")&&e.value&&-1!==e.value.indexOf("$el.")?this.set(e.name,null):-1===t.indexOf("defaultValue")&&-1===e.value.indexOf("$el.")?this.set(e.name,e.value):t.indexOf("defaultValue")>-1?this.set(e.name,e.defaultValue):this.set(e.name,void 0)},this)},w=function(){this._scAttrs&&h.each(this._scAttrs,function(e){var t=h.keys(e);-1===h.indexOf(t,"defaultValue")&&e.value&&-1!==e.value.indexOf("$el.")?this.set(e.name,null):-1===h.indexOf(t,"defaultValue")&&-1===e.value.indexOf("$el.")?this.set(e.name,e.value):h.indexOf(t,"defaultValue")>-1?this.set(e.name,e.defaultValue):this.set(e.name,void 0)},this)},y=function(e){var t=e;return function(){t.prototype.set.apply(this,arguments);var e=arguments[2];if(h.isObject(arguments[0])&&(!e||!e.local)){var i=arguments[0],n=h.keys(i);h.each(n,function(e){this.localStorage.set(e,i[e])},this)}h.isObject(arguments[0])||e&&e.computed||this.localStorage.set(arguments[0],arguments[1])}};h.extend(o,{createBehavior:function(e,i){return t.Behaviors=t.Behaviors||{},t.Behaviors[e]?t.debug("You are trying to create twice the behaviour "+e):t.Behaviors[e]=i,t.Behaviors[e]},createBaseComponent:function(e){if(!e.name||!e.selector)throw"provide a name and/or a selector";var r,a,o=e.name,s=e.selector,l=e.attributes,u=e.initialize,d=e.base,c=["attributes","name","selector","base","plugin","initialize","listenTo","_scInitFromObject","extendModel","_scInit","_scInitDefaultValue"],p=h.omit(e,c),f=i.Model,m=n.View,b=e.localStorage,x=e.extendModel||{},_=e.collection;d&&(r=h.find(t.Components,function(e){return e.type===d})),r&&(f=r.model,m=r.view),x=b?h.extend(x,{constructor:function(){f.apply(this,arguments),this._scInitDefaultValueFromLocalStorage()},set:y(f),useLocalStorage:!0}):h.extend(x,{constructor:function(){f.apply(this,arguments),this._scInitDefaultValue()}});var C=f.extend(x),V=m.extend({initialize:function(){t.debug("initialize - "+o),this._super(),this.model.componentName==o&&(this._scInitFromObject?(this._scInit(),this._scInitFromObject()):this._scInit())}});if(C=C.extend({_scAttrs:l,_scInitDefaultValue:w,_scInitDefaultValueFromLocalStorage:g}),a=h.extend(p,{_scAttrs:l,_scInit:v,_scInitFromObject:u}),e.listenTo){var I={},$=m.prototype.listen,D=e.listenTo,U=h.keys(D);h.each(U,function(e){I[e+":$this"]=D[e]}),I=h.extend($,I),V=h.extend(V,I)}var k;return _&&(k=Backbone.Collection.extend({model:_})),V=V.extend(a),t.Factories.createComponent(o,C,V,s,k)},createComponent:function(e,i,n,r,a){var o;if(!(h.isString(e)&&i&&n&&h.isString(r)))throw"please provide a correct: type (str), model, view and el (html class or id)";return t.Components=t.Components||[],t.Definitions.Models[e]=i,t.Definitions.Views[e]=n,a&&(t.Definitions.Collections[e]=a),h.each(t.Components,function(e){if(e.el===r)throw"you are trying to add compoment with the same el (.class or #id)"}),o={type:e,model:i,view:n,el:r,collection:a},t.Components.push(o),o},createApp:function(e,i,n,r){var a={};return h.isObject(e)?(a=e,t.Pipelines.Application.execute(a),a.current):(a.name=e,a.id=i,a.mainApp=n,a.app=r,a.aborted=!1,t.Pipelines.Application.execute(a),a.current)},createPageCode:function(e,i){var n;return n=t.Definitions.App.extend(i),n=n.extend({appId:e})},createBindingConverter:function(e){if(!e.name||!e.convert)throw"invalid binding converter";if(t.BindingConverters&&t.BindingConverters[e.name])throw"already a converter with the same name";t.BindingConverters=t.BindingConverters||{},t.BindingConverters[e.name]=e.convert}}),i.ComponentModel=i.Model.extend({initialize:function(){}}),i.ControlModel=i.ComponentModel.extend({initialize:function(){this._super(),this.set("isVisible",!0)},toggle:function(){this.set("isVisible",!this.get("isVisible"))}}),i.BlockModel=i.ControlModel.extend({initialize:function(){this._super(),this.set("width",0),this.set("height",0)}}),i.InputModel=i.ControlModel.extend({initialize:function(){this._super(),this.set("isEnabled",!0)}}),i.ButtonBaseModel=i.ControlModel.extend({initialize:function(){this._super(),this.set("isEnabled",!0)}});var b=e.Definitions.Views;b.ComponentView=b.View.extend({listen:h.extend({},e.Definitions.Views.View.prototype.listen,{"set:$this":"set"}),initialize:function(){if(!this.model)throw"Model required in order to instantiate ComponentView";if(!this.el)throw"Element required in order to instantiate ComponentView";var e=this.$el.data("init");if(e){var t=h.keys(e);h.each(t,function(t){this.set(t,e[t])},this.model)}},set:function(e){e&&h.each(h.keys(e),function(t){this.model.set(t,e[t])},this)}}),b.ControlView=b.ComponentView.extend({listen:h.extend({},e.Definitions.Views.ComponentView.prototype.listen,{"toggle:$this":"toggle","focus:$this":"focus","show:$this":"show","hide:$this":"hide"}),initialize:function(){this._super(),this.model.set("isVisible","none"!==this.$el.css("display"))},focus:function(){this.$el.focus()},hide:function(){this.model.set("isVisible",!1)},show:function(){this.model.set("isVisible",!0)},toggle:function(){this.model.toggle()}}),b.BlockView=b.ControlView.extend({initialize:function(){this._super(),this.model.set("width",this.$el.width()),this.model.set("height",this.$el.height())}}),b.InputView=b.ControlView.extend({listen:h.extend({},e.Definitions.Views.ComponentView.prototype.listen,{"enable:$this":"enable","disable:$this":"disable"}),initialize:function(){this._super(),this.model.set("isEnabled","disabled"!=p(this.el).attr("disabled"))},disable:function(){this.model.set("isEnabled",!1)},enable:function(){this.model.set("isEnabled",!0)}}),b.ButtonBaseView=b.ControlView.extend({listen:h.extend({},e.Definitions.Views.ControlView.prototype.listen,{"enable:$this":"enable","disable:$this":"disable"}),initialize:function(){this._super(),this.model.set("isEnabled","disabled"!=p(this.el).attr("disabled"))},click:function(){if(this.model.get("isEnabled")){var t=this.$el.attr("data-sc-click");t&&e.Helpers.invocation.execute(t,{control:this,app:this.app}),this.model._events&&this.model._events.click&&h.each(this.model._events.click,function(e){e.callback&&e.context&&e.callback.call(e.context)})}},disable:function(){this.model.set("isEnabled",!1)},enable:function(){this.model.set("isEnabled",!0)}}),t.Definitions.Collections=t.Definitions.Collections||[],o.createComponent("ComponentBase",i.ComponentModel,n.ComponentView,".sc-componentbase"),o.createComponent("ControlBase",i.ControlModel,n.ControlView,".sc-controlbase"),o.createComponent("BlockBase",i.BlockModel,n.BlockView,".sc-blockbase"),o.createComponent("ButtonBase",i.ButtonBaseModel,n.ButtonBaseView,".sc-buttonBase"),o.createComponent("InputBase",i.InputModel,n.InputView,".sc-inputbase"),o.createComponent("PageBase",i.Model,n.View,"body"),o.createBindingConverter({name:"Has",convert:function(e){return e&&e[0]?h.isArray(e[0])?0===e[0].length?!1:!0:!0:!1}}),o.createBindingConverter({name:"Not",convert:function(e){return!(e&&e[0])}});var x={combine:function(){if(0===arguments.length)return"";var e=h.reduce(arguments,function(e,t){return t&&h.isString(t)?e+"/"+h.compact(t.split("/")).join("/"):e});return e?0===e.indexOf("/")?e:"/"+e:""},isParameterNameAlreadyInUrl:function(e,t){return e.indexOf("?"+t+"=")>=0||e.indexOf("&"+t+"=")>=0},addQueryParameters:function(e,t){var i,n=h.pairs(t),r="([\\?&])({{param}}=[^&]+)",a=e;return h.each(n,function(e){x.isParameterNameAlreadyInUrl(a,e[0])?(i=RegExp(r.replace("{{param}}",encodeURIComponent(e[0])),"i"),a=a.replace(i,"$1"+e[0]+"="+e[1])):(a=a+=~a.indexOf("?")?"&":"?",a+=encodeURIComponent(e[0])+"="+encodeURIComponent(e[1]))}),a},getQueryParameters:function(e){var t,i={};return h.isString(e)?(t=e.split("?"),(t=t.length>1?t[1].split("&"):t[0].split("&"))?(h.each(t,function(e){var t=e.split("=");2===t.length&&(i[t[0]]=decodeURIComponent(t[1].replace(/\+/g," ")))}),i):void 0):i}},_={parseISO:function(e){var t,i,n,r,a,o;return h.isString(e)?(t=parseInt(e.substr(0,4),10),i=parseInt(e.substr(4,2),10)-1,n=parseInt(e.substr(6,2),10),8!==e.indexOf("T")?new Date(Date.UTC(t,i,n,0,0,0,0)):(r=parseInt(e.substr(9,2),10),a=parseInt(e.substr(11,2),10),o=parseInt(e.substr(13,2),10),new Date(Date.UTC(t,i,n,r,a,o)))):null},toISO:function(e){var t;return h.isDate(e)?(t="",t+=e.getUTCFullYear(),t+=this.ensureTwoDigits(e.getUTCMonth()+1),t+=this.ensureTwoDigits(e.getUTCDate()),t+="T",t+=this.ensureTwoDigits(e.getUTCHours()),t+=this.ensureTwoDigits(e.getUTCMinutes()),t+=this.ensureTwoDigits(e.getUTCSeconds())):t},isISO:function(e){var t,i=h.isString(e);return i&&":"===e.charAt(15)&&(e=e.substr(0,15)),!i||8!=e.length&&15!=e.length?!1:(t=this.parseISO(e),"[object Date]"===Object.prototype.toString.call(t)?isNaN(t.getYear())?!1:!0:!1)},ensureTwoDigits:function(e){return 10>e?"0"+(""+e):""+e}},C={isId:function(e){return h.isString(e)?/^\{?[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\}?$/i.test(e):!1},toId:function(e){return e&&32===e.length?"{"+e.substr(0,8)+"-"+e.substr(8,4)+"-"+e.substr(12,4)+"-"+e.substr(16,4)+"-"+e.substr(20,12)+"}":e},toShortId:function(e){return h.isString(e)&&C.isId(e)?e.replace(/-|\{|\}/g,""):void 0}},V={endsWith:function(e,t){return t&&e?e.lastIndexOf(t)===e.length-t.length:!1},equals:function(e,t,i){return h.isString(e)&&h.isString(t)?i?h.isBoolean(i)?e===t:void 0:e.toLowerCase()===t.toLowerCase():void 0},format:function(e){return e?(h.each(arguments,function(t,i){e=e.replace(RegExp("\\{"+(i-1)+"\\}","gi"),t)}),e):e},formatByTemplate:function(e,t){if("function"!=typeof t)return e;if("string"!=typeof e)return"";var i=/{{(.*?)}}/gi,n=e.match(i);return h.each(n,function(i){var n=i.replace("{{","").replace("}}",""),r=t(n);r!==void 0&&null!=r&&(e=e.replace(i,r))}),e}},I={getOwnProperties:function(e){var t,i=[];for(t in e)e.hasOwnProperty(t)&&i.push(t);return i}},$={execute:function(e,i){if(e){var n=e.indexOf(":");if(0>=n)throw"Invocation is malformed (missing 'handler:')";i=i||{};var r=e.substr(0,n),a=e.substr(n+1),o=h.extend({},{handler:r,target:a},i);t.Pipelines.Invoke.execute(o)}}},D={loadOverlays:function(e){var i=p("script[type='text/x-sitecore-overlays']");if(0!=i.length){var n=i.data("sc-overlays").split("|"),r=i.data("sc-parameters");for(var a in n){var o=n[a]+"?speak="+t.VERSION+"&"+r;p.ajax({url:o,dataType:"json"}).done(function(i){t.Helpers.overlay.processOverlays(e,i,n[a])}).fail(function(e){console.log("Overlay url failed: "+o,e)})}}},processOverlays:function(e,t,i){var n=t.overlays;for(var r in n)this.processOverlay(e,n[r],i)},processOverlay:function(e,t,i){var n,r=t.command,a=t.selector,o=t.placement,s=t.html;if("component:"==a.substr(0,10)){var l=a.substr(10),u=h.find(e.Controls,function(e){return e.name==l});if(null==u)return console.log("Overlay selector not found: "+a),void 0;n=u.view.$el}else n=p(a);if(null==n||0==n.length)return console.log("Overlay selector not found: "+a),void 0;switch(r){case"insert":this.insert(e,n,o,s,i);break;case"remove":this.remove(e,n);break;case"replace":this.replace(e,n,s,i);break;default:console.log("Unknow overlay command: "+r)}},insert:function(e,i,n,r,a){r="<div data-sc-app id='"+h.uniqueId("overlay-")+"' >"+r,r+="</div>";var o=p(p.parseHTML(r));switch(n){case"before":o.insertBefore(i);break;case"after":o.insertAfter(i);break;case"prepend":i.prepend(r);break;case"append":i.append(r);break;default:console.log("Unknow overlay insert placement: "+n)}t.load(window,o,function(e){t.trigger("overlay-loaded",{app:e,url:a})})},remove:function(e,t){t.remove()},replace:function(e,i,n,r){n=p.parseHTML(n),$html=p(n),i.replaceWith($html),t.load(window,$html,function(e){t.trigger("overlay-loaded",{app:e,url:r})})}},U={init:function(){p(window).resize(function(){t.trigger("window:resize",p(window).width(),p(window).height())})},loaded:function(){t.trigger("window:loaded")}},k=p("input[name=__RequestVerificationToken]").val(),M={getAntiForgeryToken:function(){return{formKey:"__RequestVerificationToken",headerKey:"X-RequestVerificationToken",value:k}}},A={unauthorized:function(){A.logout(function(){window.top.location.reload(!0)})},logout:function(e){var i={url:"/api/sitecore/Authentication/Logout?sc_database=master",type:"POST",data:{},cache:!1},n=t.Helpers.antiForgery.getAntiForgeryToken();i.data[n.formKey]=n.value,p.ajax(i).complete(e)}};h.extend(t,{Helpers:{antiForgery:M,url:x,date:_,id:C,string:V,object:I,invocation:$,overlay:D,window:U,session:A}}),t.Helpers.window.init();var S=t.Helpers,T={_current:0,converters:[],aborted:!1},R=function(){return T.converters.length},O=function(e){if(e=e||{},!(h.isFunction(e.canConvert)&&h.isFunction(e.convert)&&h.isFunction(e.reConvert)&&h.isString(e.name)))throw"invalid converter";T.converters.push(e)},B=function(e){T.converters=h.reject(T.converters,function(t){return t.name===e})},P=function(e){return h.find(T.converters,function(t){return t.name===e})},F=function(){return T.converters},N={name:"date",canConvert:function(e){return S.string.equals(e.type,this.name)||S.string.equals(e.type,"datetime")},convert:function(e){var t="",i=e.value;if(i)try{return S.date.parseISO(i).toLocaleDateString()}catch(n){return t}return t},reConvert:function(e){if(!e)return"";try{var t=new Date(e);return S.date.toISO(t)}catch(i){return e||""}},toStringWithFormat:function(e,t){if(S.date.isISO(e))try{var i=S.date.parseISO(e),n={mmss:{expression:"(\\W|^)mm(\\W+s{1,2}\\W|\\W+s{1,2}$)",value:S.date.ensureTwoDigits(i.getUTCMinutes())},mss:{expression:"(\\W|^)m(\\W+s{1,2}\\W|\\W+s{1,2}$)",value:""+i.getUTCMinutes()},hmm:{expression:"(\\Wh{1,2}\\W+|^h{1,2}\\W+)mm(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCMinutes())},hm:{expression:"(\\Wh{1,2}\\W+|^h{1,2}\\W+)m(\\W|$)",value:""+i.getUTCMinutes()},ms:{expression:"(\\Wss\\W|^ss\\W)00(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCMilliseconds())},ampm:{expression:"(\\W|^)AM/PM(\\W|$)",value:i.getUTCHours()>=12?"PM":"AM"},ap:{expression:"(\\W|^)A/P(\\W|$)",value:i.getUTCHours()>=12?"P":"A"},yyyy:{expression:"(\\W|^)yyyy(\\W|$)",value:""+i.getUTCFullYear()},yy:{expression:"(\\W|^)yy(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCFullYear()%100)},mm:{expression:"(\\W|^)mm(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCMonth()+1)},m:{expression:"(\\W|^)m(\\W|$)",value:""+(i.getUTCMonth()+1)},dd:{expression:"(\\W|^)dd(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCDate())},d:{expression:"(\\W|^)d(\\W|$)",value:""+i.getUTCDate()},hh:{expression:"(\\W|^)hh(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCHours())},h:{expression:"(\\W|^)h(\\W|$)",value:i.getUTCHours()>12?""+(i.getUTCHours()-12):""+(0==i.getUTCHours()?12:i.getUTCHours())},ss:{expression:"(\\W|^)ss(\\W|$)",value:S.date.ensureTwoDigits(i.getUTCSeconds())},s:{expression:"(\\W|^)s(\\W|$)",value:""+i.getUTCSeconds()}};for(var r in n){var a=n[r]?n[r].expression:"",o="$1"+n[r].value+"$2";if(""!=a){var s=RegExp(a,"g");t=t.replace(s,o)}}return t}catch(l){return e}return e}},W={name:"Icon",baseUrl:S.url.combine(t.SiteInfo.virtualFolder,"~/icon/"),canConvert:function(e){return S.string.equals(e.type,this.name)},convert:function(e){if(this.canConvert(e)){var t=e.value||"/sitecore/images/blank.gif";return 0!==t.indexOf("/sitecore/")&&(t=S.url.combine(this.baseUrl,t)),S.string.format('<img src="{0}" alt="" />',t)}},reConvert:function(){}},j={length:R,add:O,remove:B,get:P,getAll:F};j.add(N),j.add(W),h.extend(t,{Converters:j});var E=e.Pipelines=function(){var t=[];return{add:function(e){if(!e||!e.name||!h.isObject(e))throw new"invalid pipeline";t.push(e),this[e.name]=e},remove:function(i){t=h.reject(t,function(e){return e.name===i}),delete e.Pipelines[i]},length:function(){return t.length}}}();E.Pipeline=function(e){var t={name:e,processors:[],add:function(e){if(!(e&&e.priority&&e.execute&&h.isNumber(e.priority)&&h.isFunction(e.execute)))throw"not valid step";this.processors.push(e)},length:function(){return this.processors.length},remove:function(e){this.processors=h.reject(this.processors,function(t){return t===e})},execute:function(e){var t=h.sortBy(this.processors,function(e){return e.priority});h.each(t,function(t){return e.aborted?!1:(t.execute(e),void 0)})}};return t};var H=function(e,t){var i=e.split("."),n=i[0];if("this"===n)Function(e).call(t.control.model);else if(t.app&&"app"===n){var r=e.replace("app","this");Function(r).call(t.app)}else Function(e)()},q={priority:1e3,execute:function(e){"javascript"===e.handler&&(e.target.indexOf(";")>0?h.each(e.target.split(";"),function(t){H(t,e)}):H(e.target,e))}},z={priority:2e3,execute:function(t){"command"===t.handler&&e.Commands.executeCommand(t.target)}},L={priority:3e3,execute:function(t){if("serverclick"===t.handler){var i={url:t.target,type:"POST",dataType:"json",data:{}},n=e.Helpers.antiForgery.getAntiForgeryToken();i.data[n.formKey]=n.value;var r=function(i){e.Pipelines.ServerInvoke.execute({data:i,model:t.model})};p.ajax(i).done(r)}}},Q={priority:4e3,execute:function(e){if("trigger"===e.handler){var t=e.app;if(!t)throw"An application is a required when triggering events";
var i=e.target,n={},r=i.indexOf("(");if(r>=0){if(-1==i.indexOf(")",i.length-1))throw"Missing ')'";var a=i.substr(r+1,i.length-r-2);n=p.parseJSON(a),i=i.substr(0,r)}n.sender=e.control,t.trigger(i,n)}}},K=new e.Pipelines.Pipeline("Invoke");K.add(q),K.add(z),K.add(L),K.add(Q),e.Pipelines.add(K);var Y=new e.Pipelines.Pipeline("ServerInvoke");e.Pipelines.add(Y);var G=new E.Pipeline("Application"),J=function(){return{}},X=function(e,t,i,n,r,a,o,s,l){var u,d,c,f,m,v=p(t);if(l){var g=v.find("[data-sc-app]");g.length>0&&p.each(g,function(){p(this).addClass("data-sc-waiting")})}if(!v.data("sc-app")){u=h.uniqueId("sc_"+e.type+"_"),d=v.attr("data-sc-id"),o.appId&&(d=o.appId+":"+d);var w=h.filter(v.prop("class").split(" "),function(e){return-1===e.indexOf("sc_")});if(v.prop("class",w.join(" ")),v.addClass(u),n&&p("[data-sc-exclude] ."+u).length)return{};if(r&&v.closest("[data-sc-app]").attr("id")&&"#"+v.closest("[data-sc-app]").attr("id")!=a)return{};c=new e.model({type:u,name:d}),c.componentName=e.type,v.data("sc-app",i),v.addClass("data-sc-registered"),e.collection&&(f=new e.collection);var y=v.data("sc-behaviors");if(m=new e.view({el:"."+u,model:c,collection:f,app:o,behaviors:y}),h.each(m.$el.find("[data-bind]"),function(e){var t=p(e);0==t.closest(".data-sc-waiting").length&&t.addClass("data-sc-registered")},this),m.$el.find("*").contents().each(function(){try{this.registered=8===this.nodeType?!0:!1}catch(e){}}),o[d]=c,f&&h.extend(o[d],J(f,e.collection.prototype.defaults)),s.Controls.push({name:d,model:c,view:m,collection:f}),l){var b=v.find(".data-sc-waiting");b.each(function(){p(this).removeClass("data-sc-waiting")})}}return o},Z=function(e,t){return e||(t="body",e="app"),t||(t=e),"body"!==t&&0>t.indexOf("#")&&(t="#"+t),{name:e,el:t,$el:p(t)}},et=function(e,t){0===e.find("[data-sc-hasnested]").length?t(e):(h.each(e.find("[data-sc-hasnested]"),function(e){et(p(e),t)}),t(e))},tt={priority:1e3,execute:function(i){i=i||{};var n=i.name,r=i.id,a=i.mainApp,o=i.app,s=Z(n,r),l=p(s.$el).find("[data-sc-exclude]"),d=l.length||!1,c=p(s.$el).find("[data-sc-app]").length||!1,f=[];if(o=o||new e.Definitions.App,o.Controls=i.Controls=[],a||(a=e),a[s.name])throw"already an app with this name";o.ScopedEl=s.$el,o.name=s.name,t.Components&&t.Components.length>0&&h.each(t.Components,function(e){p(s.$el).find(e.el+":not(.data-sc-registered)").each(function(){p(this).data("sc-hasnested")?f.push(e):X(e,this,s.name,d,c,s.$el.selector,o,i)})}),f.length>0&&h.each(f,function(e){p(s.$el).find(e.el+":not(.data-sc-registered)").each(function(){var e=p(this);et(e,function(e){var t=h.find(f,function(t){return e.is(t.el)});X(t,e.get(0),s.name,d,c,s.$el.selector,o,i,!0)})})}),h.each(i.Controls,function(e){if(e.view.listen){var t=h.keys(e.view.listen);h.each(t,function(t){var i=t;if(i.indexOf(":$this")>=0){var n=e.view.$el.attr("data-sc-id");if(!n)return;i=i.replace("$this",n)}o.on(i,e.view[e.view.listen[t]],e.view)})}}),a===e?a[s.name]=u?o:"application":(a[s.name]=o,a.nested=a.nested||[],a.nested.push(o)),s.$el.find("[data-sc-app]").each(function(){var e,i=p(this),n=i.attr("data-sc-app"),r=i.find("script[type='text/x-sitecore-pagecode']");r&&(e=r.attr("data-sc-require")),e?require(e.split(","),function(e){var t=new e;t.run(n,n,o)}):t.Factories.createApp({name:n,id:n,mainApp:o,aborted:!1})}),i.current=o}},it=function(e){var i=t.BindingConverters[e];return i?i:void 0},nt=function(e){if(e.converter){var t=[];return h.each(e.from,function(e){t.push(e.model.get(e.attribute))}),e.converter(t)}var i=e.from[0].model,n=e.from[0].attribute;return i.get(n)},rt=function(e){h.each(e.from,function(t){t.model.on("change:"+t.attribute,function(){e.model.set(e.to,nt(e))})}),e.model.set(e.to,nt(e))},at=function(e,t){var i=h.keys(e.attributes),n=h.find(i,function(e){return e===t});return n?t:t.charAt(0).toLowerCase()+t.slice(1)},ot=function(e,t){var i=h.keys(e),n=h.find(i,function(e){return e===t});return n?e[t]:e[t.charAt(0).toUpperCase()+t.slice(1)]},st=function(e,t,i){var n=i,r=e.attr("data-sc-bindings"),a=[],o=t[n];if(0!=r.indexOf("{")){var s=[];h.each(r.split(","),function(e){var t=[];h.each(e.split(":"),function(e){t.push('"'+e+'"')}),s.push(t.join(":"))}),r="{"+s.join(",")+"}"}try{var l=JSON.parse(r);h.each(h.keys(l),function(e){var i,n,r={from:[],to:e,converter:void 0,model:o},s=l[e];r.to=at(o,e),h.isObject(s)?(r.converter=it(s.converter),h.each(s.parameters,function(e){i=ot(t,e.split(".")[0]),n=at(i,e.split(".")[1]),r.from.push({model:i,attribute:n})})):(i=t[s.split(".")[0]],n=at(i,s.split(".")[1]),r.from.push({model:i,attribute:n})),a.push(r)}),h.each(a,rt)}catch(u){throw"Failed to data-bind: "+i+"\n"+u}},lt={priority:1500,execute:function(e){0!==e.current.Controls.length&&h.each(e.current.Controls,function(t){t.view.$el.attr("data-sc-bindings")&&st(t.view.$el,e.current,t.view.$el.attr("data-sc-id"))})}},ut={priority:2e3,execute:function(e){h.each(e.Controls,function(e){e.view.beforeRender&&e.view.beforeRender()})}},dt={priority:3e3,execute:function(e){h.each(e.Controls,function(e){e.view.render&&e.view.render()})}},ct={priority:4e3,execute:function(e){h.each(e.Controls,function(e){e.view.afterRender&&e.view.afterRender()})}};G.add(tt),G.add(lt),G.add(ut),G.add(dt),G.add(ct),e.Pipelines.add(G),h.extend(t.Web,{itemWebApi:{takeValidScope:function(e){switch(e){case"self":return"s";case"children":return"c";case"parent":return"p";default:throw"Unsupported scope. It must be either 'self', 'children' or 'parent'"}},addScope:function(e,i){if(i&&h.isArray(i)){var n=h.compact(h.map(i,t.Web.itemWebApi.takeValidScope)).join("|");e=t.Helpers.url.addQueryParameters(e,{scope:n})}return e},addDatabase:function(e,i){return i&&h.isString(i)&&(e=t.Helpers.url.addQueryParameters(e,{sc_database:i})),e},addContentDatabase:function(e,i){return i&&h.isString(i)&&(e=t.Helpers.url.addQueryParameters(e,{sc_content:i})),e},addItemSelectorUrlPortion:function(i,n,r){return n&&h.isString(n)&&(r&&r.facetsRootItemId&&(i=t.Helpers.url.addQueryParameters(i,{facetsRootItemId:r.facetsRootItemId})),0===n.indexOf("search:")?(i=t.Helpers.url.addQueryParameters(i,{search:n.substr("search:".length)}),r&&r.root&&e.Helpers.id.isId(r.root)&&(i=t.Helpers.url.addQueryParameters(i,{root:r.root})),r&&r.searchConfig&&(i=t.Helpers.url.addQueryParameters(i,{searchConfig:r.searchConfig}))):i=0===n.indexOf("query:")?t.Helpers.url.addQueryParameters(i,{query:n.substr("query:".length)}):t.Helpers.id.isId(n)?t.Helpers.url.addQueryParameters(i,{sc_itemid:n}):t.Helpers.url.combine(i,n)),i},addLanguage:function(e,i){return i&&(e=t.Helpers.url.addQueryParameters(e,{language:i})),e},addItemVersion:function(e,i){return i&&(e=t.Helpers.url.addQueryParameters(e,{sc_itemversion:i})),e},getUrl:function(e,i){i=i||{};var n="/-/item/v1",r="";i.webApi&&(n=i.webApi),i.virtualFolder&&(r=i.virtualFolder);var a=t.Helpers.url.combine(n,r);return a=this.addItemSelectorUrlPortion(a,e,i),i.scope&&(a=this.addScope(a,i.scope)),i.database&&""!=e&&0===e.indexOf("search:")?a=this.addContentDatabase(a,i.database):i.database&&(a=this.addDatabase(a,i.database)),i.language&&(a=this.addLanguage(a,i.language)),i.version&&(a=this.addItemVersion(a,i.version)),i.payLoad&&(a=t.Helpers.url.addQueryParameters(a,{payload:"full"})),i.formatting&&(a=t.Helpers.url.addQueryParameters(a,{format:i.formatting})),i.sorting&&(a=t.Helpers.url.addQueryParameters(a,{sorting:i.sorting})),i.showHiddenItems&&(a=t.Helpers.url.addQueryParameters(a,{showHiddenItems:i.showHiddenItems})),i.fields&&(a=t.Helpers.url.addQueryParameters(a,{fields:i.fields.join("|")})),i.pageSize&&i.pageSize>0&&(a=t.Helpers.url.addQueryParameters(a,{pageIndex:i.pageIndex,pageSize:i.pageSize})),a}}}),function(t){var i,n=t.Backbone,r=t._,a=t.$,o=n.View.prototype._configure;n.View.prototype.render;var s=Array.prototype.push,l=Array.prototype.concat,u=Array.prototype.splice,d=e.Definitions.Views.View.extend({constructor:function(e){e=e||{},d.setupView(this,e),n.View.call(this,e)},nestedlayout:!0,insertView:function(e,t){return t?this.setView(e,t,!0):this.setView(e,!0)},insertViews:function(e){return r.isArray(e)?this.setViews({"":e}):(r.each(e,function(t,i){e[i]=r.isArray(t)?t:[t]}),this.setViews(e))},getView:function(e){return this.getViews(e).first().value()},getViews:function(e){var t=r.chain(this.views).map(function(e){return r.isArray(e)?e:[e]},this).flatten().value();return"string"==typeof e?r.chain([this.views[e]]).flatten():r.chain("function"==typeof e?r.filter(t,e):t)},setView:function(e,t,i){var n,a,o,s=this;if("string"!=typeof e&&(i=t,t=e,e=""),this.views=this.views||{},n=t.__manager__,a=this.views[e],!n)throw Error("Please set `View#manage` property with selector '"+e+"' to `true`.");return o=t._options(),n.parent=s,n.selector=e,i?(this.views[e]=l.call([],a||[],t),n.append=!0,t):(n.hasRendered&&o.partial(s.el,n.selector,t.el,n.append),a&&r.each(l.call([],a),function(e){e.remove()}),this.views[e]=t)},setViews:function(e){return r.each(e,function(e,t){return r.isArray(e)?r.each(e,function(e){this.insertView(t,e)},this):(this.setView(t,e),void 0)},this),this},render:function(){function e(){function e(){var e=n.afterRender;e&&e.call(i,i),i.trigger("afterRender",i)}var t,r;return o&&(n.contains(o.el,i.el)||n.partial(o.el,a.selector,i.el,a.append)),i.delegateEvents(),a.hasRendered=!0,u.resolveWith(i,[i]),(t=a.queue.shift())?t():delete a.queue,l&&l.queue?(r=function(){o.off("afterRender",r,this),e()},o.on("afterRender",r,i)):(e(),void 0)}function t(){var t=i._options(),n=i.__manager__,a=n.parent;a&&a.__manager__,i._render(d._viewRender,t).done(function(){if(!r.keys(i.views).length)return e();var n=r.map(i.views,function(e){var i=r.isArray(e);return i&&e.length?e[0].render().pipe(function(){return t.when(r.map(e.slice(1),function(e){return e.render()}))}):i?e:e.render()});t.when(n).done(function(){e()})})}var i=this,n=i._options(),a=i.__manager__,o=a.parent,l=o&&o.__manager__,u=n.deferred();return a.queue?s.call(a.queue,function(){t()}):(a.queue=[],t(i,u)),u.view=i,u},remove:function(){return d._removeView(this,!0),this._remove.apply(this,arguments)},_options:function(){return d.augment({},this,d.prototype.options,this.options)}},{_cache:{},_makeAsync:function(e,t){var i=e.deferred();return i.async=function(){return i._isAsync=!0,t},i},_viewRender:function(e,t){function i(i){i&&t.html(e.$el,i),s.resolveWith(e,[e])}function n(e,n){var r,o=d._makeAsync(t,function(e){i(e)});d.cache(a,n),n&&(r=t.render.call(o,n,e)),o._isAsync||i(r)}var a,o,s;return e.__manager__,{render:function(){var i=e.serialize||t.serialize,l=e.data||t.data,u=i||l,c=e.template||t.template,p="";return e.parent&&e.parent.$el&&(p=e.parent.$el.data("sc-id")),r.isFunction(u)&&(u=u.call(e)),s=d._makeAsync(t,function(e){n(u,e)}),"string"==typeof c&&(a=t.prefix+c),(o=d.cache(a+p))?(n(u,o,a),s):("string"==typeof c?o=t.fetch.call(s,t.prefix+c,p):null!=c&&(o=t.fetch.call(s,c)),s._isAsync||n(u,o),s)}}},_removeViews:function(e,t){"boolean"==typeof e&&(t=e,e=this),e=e||this,e.getViews().each(function(e){(e.__manager__.hasRendered||t)&&d._removeView(e,t)})},_removeView:function(e,t){var i,n=e.__manager__,a="boolean"==typeof e.keep?e.keep:e.options.keep;if(!a&&(n.append===!0||t)){if(d.cleanViews(e),e._removeViews(!0),e.$el.remove(),!n.parent)return;if(i=n.parent.views[n.selector],r.isArray(i))return r.each(r.clone(i),function(e,t){e&&e.__manager__===n&&u.call(i,t,1)});delete n.parent.views[n.selector]}},cleanViews:function(e){r.each(l.call([],e),function(e){e.unbind(),e.model instanceof n.Model&&e.model.off(null,null,e),e.collection instanceof n.Collection&&e.collection.off(null,null,e),e.cleanup&&e.cleanup.call(e)})},cache:function(e,t){return e in this._cache?this._cache[e]:null!=e&&null!=t?this._cache[e]=t:void 0},configure:function(e){this.augment(d.prototype.options,e),e.manage&&(n.View.prototype.manage=!0)},augment:r.forIn?function(e){return r.reduce(Array.prototype.slice.call(arguments,1),function(e,t){return r.forIn(t,function(t,i){e[i]=t}),e},e)}:r.extend,setupView:function(e,t){if(!e.__manager__){var a,o,s,u=n.LayoutManager.prototype,c=r.pick(e,i);r.defaults(e,{views:{},__manager__:{},_removeViews:d._removeViews,_removeView:d._removeView},d.prototype),t=e.options=r.defaults(t||{},e.options,u.options),s=r.pick(t,l.call(["events"],r.values(t.events||{}))),d.augment(e,s),(c.render===d.prototype.render||c.render===n.View.prototype.render)&&delete c.render,d.augment(t,c),e._remove=n.View.prototype.remove,e._render=function(e,t){var i=this,n=i.__manager__,r=t.beforeRender;return n.hasRendered&&this._removeViews(),r&&r.call(this,this),this.trigger("beforeRender",this),e(this,t).render()},e.render=d.prototype.render,e.remove!==u.remove&&(e._remove=e.remove,e.remove=u.remove),a=t.views||e.views,r.keys(a).length&&(o=a,e.views={},e.setViews(o)),e.options.template?e.options.template=t.template:e.template&&(t.template=e.template,delete e.template)}}});e.Definitions.Views.CompositeView=n.Layout=n.LayoutView=n.LayoutManager=d,d.VERSION="0.7.5",n.View.prototype._configure=function(){var e=o.apply(this,arguments);return this.manage&&d.setupView(this),e},d.prototype.options={prefix:"",deferred:function(){return a.Deferred()},fetch:function(e){return r.template(a(e).html())},partial:function(e,t,i,n){var r=t?a(e).find(t):a(e);this[n?"append":"html"](r,i)},html:function(e,t){e.html(t)},append:function(e,t){e.append(t)},when:function(e){return a.when.apply(null,e)},render:function(e,t){return e(t)},contains:function(e,t){return a.contains(e,t)}},i=r.keys(d.prototype.options),d.prototype.options=r.extend(d.prototype.options,{fetch:function(e,t){var i="[data-layout-"+e+"]";t&&(i="[data-layout-"+e+"='"+t+"']");var n=a(i).html();if(void 0===n)throw"missing template data-layout-"+e+" in order to work";return r.template(n)}})}(this),r.DatabaseUri=function(e){if(!e)throw"Parameter 'databaseName' is null or empty";this.databaseName=e,this.webApi="",this.virtualFolder="/sitecore/shell"},h.extend(r.DatabaseUri.prototype,{getDatabaseName:function(){return this.databaseName}}),r.ItemUri=function(e,t){if(!e)throw"Parameter 'databaseUri' is null or empty";if(!t)throw"Parameter 'itemId' is null or empty";this.databaseUri=e,this.itemId=t},h.extend(r.ItemUri.prototype,{getDatabaseName:function(){return this.databaseUri.databaseName},getDatabaseUri:function(){return this.databaseUri},getItemId:function(){return this.itemId}}),r.ItemVersionUri=function(e,t,i){if(!e)throw"Parameter 'itemUri' is null";if(!t)throw"Parameter 'language' is null or empty";if(!h.isNumber(i))throw"Parameter 'version' is null or not a number";this.itemUri=e,this.language=t,this.version=i},h.extend(r.ItemVersionUri.prototype,{getDatabaseUri:function(){return this.itemUri.getDatabaseUri()},getDatabaseName:function(){return this.itemUri.getDatabaseName()},getItemUri:function(){return this.itemUri},getItemId:function(){return this.itemUri.getItemId()},getLanguage:function(){return this.language},getVersion:function(){return this.version}}),r.FieldUri=function(e,t){if(!e)throw"Parameter 'itemVersionUri' is null or empty";if(!t)throw"Parameter 'fieldId' is null or empty";this.itemVersionUri=e,this.fieldId=t},h.extend(r.FieldUri.prototype,{getDatabaseUri:function(){return this.itemVersionUri.getDatabaseUri()},getDatabaseName:function(){return this.itemVersionUri.getDatabaseName()},getItemUri:function(){return this.itemVersionUri.getItemUri()},getItemId:function(){return this.itemVersionUri.getItemId()},getLanguage:function(){return this.itemVersionUri.getLanguage()},getVersion:function(){return this.itemVersionUri.getVersion()},getFieldId:function(){return this.fieldId}}),r.Database=function(e){if(!e)throw"Parameter 'databaseUri' is null";this.databaseUri=e,this.ajaxOptions={dataType:"json"}},h.extend(r.Database.prototype,{convertToItem:function(e){return e.result?e.result.items?0===e.result.items.length?null:e.result.items.length>1?(console.debug("ERROR: Expected a single item"),null):new t.Definitions.Data.Item(e.result.items[0]):(console.debug("ERROR: No items from server"),null):(console.debug("ERROR: No data from server"),null)},convertToItems:function(e){if(!e.result)return console.debug("ERROR: No data from server"),{items:[],totalCount:0,data:e};if(!e.result.items)return console.debug("ERROR: No items from server"),{items:[],totalCount:0,data:e};var i=h.map(e.result.items,function(e){return new t.Definitions.Data.Item(e)});return{items:i,total:e.result.totalCount,data:e.result}},getItem:function(e,i,n){if(!e)throw"Parameter 'id' is null";if(!i)throw"Parameter 'completed' is null";n=n||{},e instanceof t.Definitions.Data.ItemUri&&(n.database=e.getDatabaseName(),e=e.getItemId()),e instanceof t.Definitions.Data.ItemVersionUri&&(n.database=e.getDatabaseName(),n.language=e.getLanguage(),n.version=e.getVersion(),e=e.getItemId());var r=this.getUrl(e,n);n.scope&&(h.contains(n.scope,"parent")||h.contains(n.scope,"children"))?this.get(r).pipe(this.convertToItems).done(i).fail(function(e){i(null,e)}):this.get(r).pipe(this.convertToItem).done(i).fail(function(e){i(null,e)})},search:function(e,t,i){if(!t)throw"Parameter 'completed' is null";var n=this.getUrl("search:"+e,i);this.get(n).pipe(this.convertToItems).done(function(e){t(e.items,e.total,e.data)}).fail(function(e){t([],0,e)})},query:function(e,t,i){if(!e)throw"Parameter 'queryExpression' is null";if(!t)throw"Parameter 'completed' is null";var n=this.getUrl("query:"+e,i);this.get(n).pipe(this.convertToItems).done(function(e){t(e.items,e.total,e.data)}).fail(function(e){t([],0,e)})},getChildren:function(e,t,i){if(!e)throw"Parameter 'id' is null";if(!t)throw"Parameter 'completed' is null";i=i||{},i.scope||(i.scope=["children"]);var n=this.getUrl(e,i);this.get(n).pipe(this.convertToItems).done(function(e){t(e.items,e.total,e.data)}).fail(function(e){t([],0,e)})},getUrl:function(t,i){i=i||{},i.database||(i.database=this.databaseUri.getDatabaseName()),i.webApi||(i.webApi=this.databaseUri.webApi),i.virtualFolder||(i.virtualFolder=this.databaseUri.virtualFolder);var n=e.Web.itemWebApi.getUrl(t,i);return n},get:function(e){return p.ajax({url:e,dataType:this.ajaxOptions.dataType})}}),r.Field=function(e,t,i,n,a){if(!e)throw"Parameter 'item' is null";if(!(t instanceof r.FieldUri))throw"Parameter 'fieldUri' is null";this.item=e,this.fieldUri=t,this.fieldName=i||"",this.value=n||"",this.type=a||"Single-Line Text"},h.extend(r.Field.prototype,{toModel:function(){return this.$model||(this.$model=new t.Definitions.Models.Model(this)),this.$model},toViewModel:function(){var e={fieldId:this.fieldUri.getFieldId(),fieldName:this.fieldName,type:this.type,value:new f.observable(this.value)},t=this;return e.value.subscribe(function(e){t.item[t.fieldName]=e,t.value=e}),e}}),r.LocalStorage=function(e){if(!e)throw"you need to provide a unique key";this.appID=e,this.fullKey=this.prefix+this.appID,this.localStorageLibrary=p.jStorage},h.extend(r.LocalStorage.prototype,{prefix:"#sc#",get:function(e){var t=this.fullKey+e;return this.localStorageLibrary.get(t)},getAll:function(){var e,t=this.localStorageLibrary.index(),i={};return e=h.filter(t,function(e){return e.indexOf(this.fullKey)>=0},this),h.each(e,function(e){var t=e.substring(this.fullKey.length,e.length);i[t]=this.localStorageLibrary.get(e)},this),i},deleteRecord:function(e){var t=this.fullKey+e;return this.localStorageLibrary.deleteKey(t)},set:function(e,t,i){var n=this.fullKey+e;return this.localStorageLibrary.set(n,t,i)},flush:function(){var e=this.localStorageLibrary.index(),t=h.filter(e,function(e){return e.indexOf(this.fullKey)>=0},this);h.each(t,function(e){this.localStorageLibrary.deleteKey(e)},this)}});var pt={options:function(e,t){return{dataType:"json",type:e,data:t}},convertResponse:function(e){return 200!==e.statusCode?p.Deferred().reject({readyState:4,status:e.statusCode,responseText:e.error.message}):e.result},createItem:function(e){return new t.Definitions.Data.Item(e.items[0])},triggerCreated:function(e){return t.trigger("item:created",e),e}},ht=function(e,i,n){var r,a=e;if(!e.name||!e.templateId||!e.parentId)throw"Provide valid parameter in order to create an Item";e.database||(e.database="core");var o=t.Web.itemWebApi.getUrl(a.parentId,{webApi:"/-/item/v1/sitecore/shell",database:e.database});return o=t.Helpers.url.addQueryParameters(o,{name:e.name}),o=t.Helpers.url.addQueryParameters(o,{template:e.templateId}),r=t.Helpers.antiForgery.getAntiForgeryToken(),i[r.formKey]=r.value,p.when(p.ajax(o,pt.options("POST",i))).pipe(pt.convertResponse).pipe(pt.createItem).pipe(pt.triggerCreated).done(n)},ft=function(e,i){var n;this.$fields?n=h.map(this.$fields,function(e){return{name:e.fieldName,value:this[e.fieldName]}},this):(n=h.map(this.attributes.$fields,function(e){var t;return this.attributes[e.fieldName]!==e.value?t={name:e.fieldName,value:this.attributes[e.fieldName]}:void 0},this),n=h.filter(n,function(e){return e!==void 0}));var r=this.getUrl(),a={dataType:"json",type:"PUT",data:n},o=function(e){return t.trigger("item:updated",this),e};return p.when(p.ajax(r,a)).pipe(this.convertResponse).pipe(o).done(p.proxy(e,i))},mt=function(t,i){var n=this.getUrl(),r={dataType:"json",type:"GET"},a=function(t){if(!t.items)return this;if(0===t.items.length)throw"Item not found";if(date.items.length>1)throw"Expected a single item";var i=t.items[0];return h.each(i.Fields,function(t,i){this[t.Name]=t.Value;var n=this.getFieldById(i);null!=n?n.value=t.Value:this.$fields.push(this,new e.Definitions.Data.Field(fieldUri,t.Name,t.Value,t.Type))},this),this};return p.when(p.ajax(n,r)).pipe(this.convertResponse).pipe(a).done(p.proxy(t,i))},B=function(e,i){var n=this.getUrl(),r={dataType:"json",type:"DELETE"},a=function(e){return t.trigger("item:deleted",this),e};return p.when(p.ajax(n,r)).pipe(this.convertResponse).pipe(a).done(p.proxy(e,i))},vt=function(e,i,n){var r=[{name:"__itemName",value:e}],a=this.getUrl(),o={dataType:"json",type:"PUT",data:r},s=function(e){return t.trigger("item:renamed",this),e};return p.when(p.ajax(a,o)).pipe(this.convertResponse).pipe(s).done(p.proxy(i,n))};r.createItem=ht;var gt=function(e,t,i){var n=this;i=i||{};var r=i.success||function(){t&&t(n)};switch(e){case"read":this.read(this).pipe(r);break;case"create":throw"The 'create' operation is not supported";case"update":this.update(this,i).pipe(r);break;case"delete":this.remove(this).pipe(r)}},wt=e.Definitions.Models.Model.extend({idAttribute:"itemId",getUrl:function(){var e=this.get("itemUri"),t=new r.Database(e.getDatabaseUri());return t.getUrl(e.getItemId())},read:mt,remove:B,rename:vt,update:ft});if(r.Item=function(e,t){if(!t)if(t=e,t.itemUri)e=t.itemUri;else{var i=new r.DatabaseUri(t.Database);e=new r.ItemUri(i,t.ID)}return t instanceof r.Item?(this.shallowCopy(t),void 0):(this.$fields=[],h.each(t.Fields,function(t,i){this[t.Name]=t.Value;var n=new r.FieldUri(e,i),a=new r.Field(this,n,t.Name,t.Value,t.Type);t.FormattedValue&&(a.formattedValue=t.FormattedValue),t.LongDateValue&&(a.longDateValue=t.LongDateValue),t.ShortDateValue&&(a.shortDateValue=t.ShortDateValue),this.$fields.push(a)},this),this.itemUri=e,this.itemId=e.getItemId(),this.itemName=t.Name||"",this.$displayName=t.DisplayName||"",this.$database=t.Database||"",this.$language=t.Language||"",this.$version=t.Version||0,this.$templateName=t.TemplateName||"",this.$templateId=t.TemplateId||"",this.$hasChildren=t.HasChildren||!1,this.$path=t.Path||"",this.$url=t.Url||"",this.$mediaurl=t.MediaUrl||"",this.$icon=t.Icon||"",void 0)},h.extend(r.Item.prototype,{getFieldById:function(e){return h.find(this.$fields,function(t){return t.fieldUri.getFieldId()==e},this)},shallowCopy:function(e){this.$fields=e.$fields,h.each(e.$fields,function(e){this[e.Name]=e.Value},this),this.itemUri=e.itemUri,this.itemId=e.itemId,this.itemName=e.itemName,this.$displayName=e.$displayName,this.$language=e.$language,this.$version=e.$version,this.$templateName=e.$templateName,this.$templateId=e.$templateId,this.$hasChildren=e.$hasChildren,this.$path=e.$path,this.$url=e.$url,this.$mediaurl=e.$mediaurl},toModel:function(){if(!this.$model){var e=new wt(this);return e.sync=gt,e}return this.$model},toViewModel:function(){return this.toModel().viewModel},convertResponse:pt.convertResponse}),h.extend(t.Factories,{createJQueryUIComponent:function(e,t,i,n){var r,a=e.ControlModel.extend({initialize:function(){this._super(),i.model&&h.each(h.keys(i.model),function(e){this.model[e]=i.model[e]},this),h.each(i.attributes,function(e){var t=e.defaultValue!==void 0?e.defaultValue:null;this.set(e.name,t)},this),this.initialized!==void 0&&this.initialized()}});n&&(r=e.ControlModel.extend({initialize:function(){this._super(),h.each(i.attributes,function(e){if(1!=e.added){var t=e.pluginProperty!==void 0?e.pluginProperty:e.name,i=e.defaultValue!==void 0?e.defaultValue:null;this.set(t,i)}},this),this.initialized!==void 0&&this.initialized()}}));var s=t.ControlView.extend({initialize:function(e){this._super();var t;e=e||{},i.view&&h.each(h.keys(i.view),function(e){this[e]=i.view[e]},this),n&&(this.widgetModel=new r),h.each(i.attributes,function(i){t=i.pluginProperty!==void 0?i.pluginProperty:i.name;var r=i.defaultValue!==void 0?i.defaultValue:null;r!==void 0&&null!==r&&(e[t]=r);var a=this.$el.attr("data-sc-option-"+t);a&&("true"==a&&(a=!0),"false"==a&&(a=!1),n?this.widgetModel.has(t)&&this.model.set(t,a):this.model.set(i.name,a),e[t]=a)},this),h.each(i.events,function(t){if(e[t.name]===void 0){var i=this;e[t.name]=function(e,n){i.raiseEvent(t,e,n)}}},this),this.$el[i.control](e),this.widget=this.$el[i.control],this.widget=this.widget||this.$el.data(i.control),this.widget=this.widget||this.$el.data(i.namespace+i.control),h.each(i.functions,function(e){var t=this;this[e.name]=function(){if(!t.widget[e.name]){var i=t.widget;return i.apply(t.$el,[e.name,arguments[0]])}return t.widget[e.name].apply(t.widget,arguments)}},this),n?(this.widgetModel.on("change",function(e){var t={};e.changed&&(h.each(h.keys(e.changed),function(i){t[i]=e.get(i)}),this.$el[i.control]("option",t))},this),this.model.on("change",function(e){var t,n,r={};e.changed&&(h.each(h.keys(e.changed),function(r){n=h.find(i.attributes,function(e){return e.name==r}),n&&1!=n.added&&1!=n.manualSync&&(t=n&&n.pluginProperty!==void 0?n.pluginProperty:r,this.widgetModel.set(t,e.get(r)))},this),this.$el[i.control]("option",r))},this)):this.model.on("change",function(e){var t,n,r={};e.changed&&(h.each(h.keys(e.changed),function(a){h.find(i.attributes,function(e){return e.name==a&&1==e.added})||(n=h.find(i.attributes,function(e){return e.name==a}),t=n&&n.pluginProperty!==void 0?n.pluginProperty:a,r[t]=e.get(a))}),this.$el[i.control]("option",r))},this),this.initialized!==void 0&&this.initialized()},raiseEvent:function(e,t,i){e.on&&this[e.on](t,i);var n=this.$el.attr("data-sc-id"),r=this.app[n];r&&r[e.name]!==void 0&&r[e.name](r,t,i),n&&this.app.trigger(e.name+":"+n,t,i)}});o.createComponent(i.componentName,a,s,i.selector)}}),u){var yt=0,bt=0,xt=0,_t=[],Ct=function(e){var t=0,i=[],n=0;for(var r in e)if(e[r]&&"application"===e[r].modelType){var e=e[r];xt+=1,t+=1,h.each(e.Controls,function(e){bt+=1,n+=1,_t.push(e)}),i.push(Ct(e[r]))}return{numberOfNestedApp:yt,nestedApps:i,nbControlInThisApp:n}},Vt=function(){var t=Ct(e);return{numberOfApps:yt,totalNumberOfControls:bt,totlaNumberOfApp:xt,alltheControls:_t,allApplications:t}};t.__info=function(){return{Components:{totalComponents:e.Components.length,compontentList:e.Components},Pipelines:{totalPipelines:e.Pipelines.length()},Applications:Vt()}}}}.call(window);